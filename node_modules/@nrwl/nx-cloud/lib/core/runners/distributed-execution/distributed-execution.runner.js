const a7_0x34e6=['commandStatus','readFileSync','delete','../../../utilities/environment','start','strip-json-comments','Successfully\x20completed\x20running\x20the\x20command.','error','__awaiter','./distributed-execution.api','../../../utilities/nx-imports','length','projectGraph','COMPLETED','VERBOSE_LOGGING','error:\x20','startTask','exit','criticalErrorMessage','runUrl','executionStatus','targetDependencies','projects','toString','encryptionKey','has','rxjs/internal/Observable','../../../utilities/waiter','createStartRequest','url','retrieve','success','keys','FileStorage','../../../utilities/create-no-new-messages-timeout','filter','findTask','addVerticalSeparator','ENCRYPTION_KEY','submitRunMetrics','printRunGroupError','createTaskGraph','run','reset','join','stdout','dependencies','TaskGraphCreator','finally','completeRunGroupWithError','../../error/print-run-group-error','indexOf','Waiting...','cacheDirectory','note','Status\x20update','createNoNewMessagesTimeout','../../../utilities/metric-logger','addTaskToGraph','executionId:\x20','nodes','done','axiosException','E2EEncryption','number\x20of\x20completed\x20tasks:\x20','../../file-storage/file-storage','tasks','add','Retrieving\x20artifacts\x20from\x20','copyFilesFromCache','nxCloudDistributedTasksRunner','defineProperty','find','map','overrides','taskId','terminalOutput','nx.json','./node_modules/.cache/nx','log','Waiter','endTask','lifeCycle','Processing\x20task\x20','addTaskDependencies','wait','project','size','message','strictlyOrderedTargets','Found\x20unknown\x20task:\x20','defaultTargetDependencies','Unable\x20to\x20complete\x20a\x20run.','completedTasks','roots','write','hash','addDependencies','scheduleTask','self','target','next','assign','catch','parse','push','../../file-storage/e2e-encryption','See\x20run\x20details\x20at\x20','executionStatus:\x20','DistributedExecutionApi','Main\x20job\x20terminated\x20with\x20an\x20error:\x20\x22','then'];(function(_0x24362c,_0x34e6d7){const _0x842e8a=function(_0x22c559){while(--_0x22c559){_0x24362c['push'](_0x24362c['shift']());}};_0x842e8a(++_0x34e6d7);}(a7_0x34e6,0x6d));const a7_0x842e=function(_0x24362c,_0x34e6d7){_0x24362c=_0x24362c-0x0;let _0x842e8a=a7_0x34e6[_0x24362c];return _0x842e8a;};'use strict';var __awaiter=this&&this[a7_0x842e('0xb')]||function(_0x58ad7c,_0x682b83,_0x1e954e,_0xc87430){function _0x57941b(_0x325d79){return _0x325d79 instanceof _0x1e954e?_0x325d79:new _0x1e954e(function(_0x4c3298){_0x4c3298(_0x325d79);});}return new(_0x1e954e||(_0x1e954e=Promise))(function(_0x4e55ae,_0x5ea4b3){function _0x105cb2(_0x1b3856){try{_0x20544e(_0xc87430[a7_0x842e('0x68')](_0x1b3856));}catch(_0x57fa92){_0x5ea4b3(_0x57fa92);}}function _0x52b6e4(_0x4b48a2){try{_0x20544e(_0xc87430['throw'](_0x4b48a2));}catch(_0x4269fb){_0x5ea4b3(_0x4269fb);}}function _0x20544e(_0xd8f49a){_0xd8f49a[a7_0x842e('0x40')]?_0x4e55ae(_0xd8f49a['value']):_0x57941b(_0xd8f49a['value'])[a7_0x842e('0x2')](_0x105cb2,_0x52b6e4);}_0x20544e((_0xc87430=_0xc87430['apply'](_0x58ad7c,_0x682b83||[]))[a7_0x842e('0x68')]());});};Object[a7_0x842e('0x4a')](exports,'__esModule',{'value':!![]});exports[a7_0x842e('0x32')]=exports[a7_0x842e('0x49')]=void 0x0;const Observable_1=require(a7_0x842e('0x1d'));const stripJsonComments=require(a7_0x842e('0x8'));const fs_1=require('fs');const distributed_execution_api_1=require(a7_0x842e('0xc'));const file_storage_1=require(a7_0x842e('0x44'));const e2e_encryption_1=require(a7_0x842e('0x6d'));const waiter_1=require(a7_0x842e('0x1e'));const environment_1=require(a7_0x842e('0x6'));const print_run_group_error_1=require(a7_0x842e('0x35'));const create_no_new_messages_timeout_1=require(a7_0x842e('0x25'));const metric_logger_1=require(a7_0x842e('0x3c'));const {output,getDependencyConfigs,getOutputs,unparse,Cache}=require(a7_0x842e('0xd'));class NoopLifeCycle{[a7_0x842e('0x65')](_0x30080d){}[a7_0x842e('0x13')](_0x21e332){}[a7_0x842e('0x54')](_0x290924,_0x4a4997){}}function runDistributedExecution(_0x2aedf8,_0x562812,_0x1777e8,_0x2c3b6c,_0x26ecbc,_0x4c630b,_0x50cb17){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x15fab5=JSON[a7_0x842e('0x6b')](stripJsonComments((0x0,fs_1[a7_0x842e('0x4')])(a7_0x842e('0x50'))[a7_0x842e('0x1a')]()));const _0x43c880=new TaskOrderer(_0x1777e8[a7_0x842e('0xf')],getDefaultDependencyConfigs(_0x15fab5,_0x562812))['splitTasksIntoStages'](_0x50cb17);const _0x4ed2dc=yield _0x2aedf8[a7_0x842e('0x7')]((0x0,distributed_execution_api_1[a7_0x842e('0x1f')])(_0x4c630b,_0x43c880,_0x562812));return yield processTasks(_0x2aedf8,_0x2c3b6c,_0x26ecbc,_0x562812,_0x4ed2dc,_0x50cb17,_0x1777e8);});}function processTasks(_0x69dedc,_0xb1e6e,_0x2a35b9,_0x4fdb2b,_0x2e9077,_0x487eaf,_0x12142f){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x32539b={};const _0x1633f7=(0x0,create_no_new_messages_timeout_1[a7_0x842e('0x3b')])();const _0x4b9a98=new waiter_1[(a7_0x842e('0x53'))]();while(!![]){if(environment_1[a7_0x842e('0x11')]){output[a7_0x842e('0x39')]({'title':a7_0x842e('0x37')});}yield _0x4b9a98[a7_0x842e('0x58')]();const _0x647103=yield _0x69dedc['status'](_0x2e9077);if(environment_1[a7_0x842e('0x11')]){output[a7_0x842e('0x39')]({'title':a7_0x842e('0x3a'),'bodyLines':[a7_0x842e('0x3e')+_0x2e9077,a7_0x842e('0x6f')+_0x647103[a7_0x842e('0x17')],a7_0x842e('0x43')+_0x647103[a7_0x842e('0x60')]['length'],a7_0x842e('0x12')+_0x647103[a7_0x842e('0x15')]]});}if(_0x647103[a7_0x842e('0x15')]){output['error']({'title':'Distributed\x20Execution\x20Terminated','bodyLines':['Error:',_0x647103[a7_0x842e('0x15')]]});process[a7_0x842e('0x14')](0x1);}_0x1633f7(_0x647103['completedTasks'][a7_0x842e('0xe')]);for(const _0x493799 of _0x647103[a7_0x842e('0x60')]){if(_0x32539b[_0x493799['taskId']])continue;yield processTask(_0xb1e6e,_0x2a35b9,_0x12142f,_0x4fdb2b,_0x487eaf,_0x493799);_0x4b9a98[a7_0x842e('0x2e')]();_0x32539b[_0x493799[a7_0x842e('0x4e')]]=!![];}if(_0x647103[a7_0x842e('0x17')]===a7_0x842e('0x10')){return{'commandStatus':_0x647103[a7_0x842e('0x3')],'runUrl':_0x647103[a7_0x842e('0x16')]};}}});}function processTask(_0x52d63a,_0x42f539,_0x3bc3fc,_0x4afdaa,_0x2a5d64,_0x6713ac){return __awaiter(this,void 0x0,void 0x0,function*(){if(environment_1['VERBOSE_LOGGING']){output[a7_0x842e('0x39')]({'title':a7_0x842e('0x56')+_0x6713ac[a7_0x842e('0x4e')]});}const _0x516ff6=_0x2a5d64[a7_0x842e('0x4b')](_0x44d436=>_0x6713ac['taskId']===_0x44d436['id']);if(!_0x516ff6){throw new Error(a7_0x842e('0x5d')+_0x6713ac['taskId']);}if(environment_1[a7_0x842e('0x11')]){output['note']({'title':a7_0x842e('0x47')+_0x6713ac[a7_0x842e('0x20')]});}yield _0x52d63a[a7_0x842e('0x21')](_0x6713ac[a7_0x842e('0x63')],_0x6713ac['url'],_0x4afdaa[a7_0x842e('0x38')]||a7_0x842e('0x51'));const _0x5df1d0=yield _0x42f539['get'](Object[a7_0x842e('0x69')](Object[a7_0x842e('0x69')]({},_0x516ff6),{'hash':_0x6713ac[a7_0x842e('0x63')]}));const _0x1f5ffe=getOutputs(_0x3bc3fc[a7_0x842e('0xf')][a7_0x842e('0x3f')],_0x516ff6);if(environment_1[a7_0x842e('0x11')]){output['note']({'title':'Extracting\x20artifacts','bodyLines':_0x1f5ffe});}yield _0x42f539[a7_0x842e('0x48')](_0x6713ac['hash'],_0x5df1d0,_0x1f5ffe);output['logCommand'](getCommand(_0x516ff6));process[a7_0x842e('0x30')][a7_0x842e('0x62')](_0x5df1d0[a7_0x842e('0x4f')]);output[a7_0x842e('0x28')]();});}function getCommand(_0x2698f6){const _0x596129=unparse(_0x2698f6[a7_0x842e('0x4d')]||{});const _0x173911=_0x2698f6[a7_0x842e('0x67')]['configuration']?':'+_0x2698f6[a7_0x842e('0x67')]['configuration']:'';return['nx',a7_0x842e('0x2d'),_0x2698f6[a7_0x842e('0x67')][a7_0x842e('0x59')]+':'+_0x2698f6[a7_0x842e('0x67')]['target']+_0x173911,..._0x596129][a7_0x842e('0x2f')]('\x20');}const nxCloudDistributedTasksRunner=(_0x532410,_0x2d3f1f,_0x5d4502)=>{if(environment_1[a7_0x842e('0x11')]){output[a7_0x842e('0x39')]({'title':'Starting\x20distributed\x20command\x20execution'});}_0x2d3f1f[a7_0x842e('0x55')]=new NoopLifeCycle();const _0xb7a129=(0x0,environment_1['getRunGroup'])();if(!_0xb7a129){(0x0,print_run_group_error_1[a7_0x842e('0x2b')])();return process[a7_0x842e('0x14')](0x1);}const _0x20c512=new e2e_encryption_1[(a7_0x842e('0x42'))](environment_1[a7_0x842e('0x29')]||_0x2d3f1f[a7_0x842e('0x1b')]);const _0x3f8a53=new file_storage_1[(a7_0x842e('0x24'))](_0x20c512);const _0x2d2ed6=new Cache(_0x2d3f1f);const _0x9550be=new distributed_execution_api_1[(a7_0x842e('0x0'))](_0x2d3f1f);runDistributedExecution(_0x9550be,_0x2d3f1f,_0x5d4502,_0x3f8a53,_0x2d2ed6,_0xb7a129,_0x532410)[a7_0x842e('0x2')](_0x15a21f=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){if(_0x15a21f[a7_0x842e('0x3')]===0x0){output[a7_0x842e('0x22')]({'title':a7_0x842e('0x9'),'bodyLines':[a7_0x842e('0x6e')+_0x15a21f[a7_0x842e('0x16')]]});}else{output[a7_0x842e('0xa')]({'title':'Command\x20execution\x20failed.','bodyLines':[a7_0x842e('0x6e')+_0x15a21f[a7_0x842e('0x16')]]});}yield(0x0,metric_logger_1[a7_0x842e('0x2a')])(_0x2d3f1f);process[a7_0x842e('0x14')](_0x15a21f['commandStatus']);}))[a7_0x842e('0x6a')](_0x50962b=>{output[a7_0x842e('0xa')]({'title':a7_0x842e('0x5f'),'bodyLines':[_0x50962b[a7_0x842e('0x5b')]]});if(_0x50962b[a7_0x842e('0x41')]){console[a7_0x842e('0x52')](_0x50962b[a7_0x842e('0x41')]);}else{console[a7_0x842e('0x52')](_0x50962b);}_0x9550be[a7_0x842e('0x34')](_0xb7a129,a7_0x842e('0x1')+_0x50962b[a7_0x842e('0x5b')]+'\x22')[a7_0x842e('0x33')](()=>process[a7_0x842e('0x14')](0x1));});return new Observable_1['Observable'](()=>{});};exports[a7_0x842e('0x49')]=nxCloudDistributedTasksRunner;class TaskOrderer{constructor(_0x4c6cf4,_0x1106a3){this['projectGraph']=_0x4c6cf4;this[a7_0x842e('0x5e')]=_0x1106a3;}['splitTasksIntoStages'](_0x5ea7fd){if(_0x5ea7fd[a7_0x842e('0xe')]===0x0)return[];const _0x3fba03=[];const _0x152ba4=this[a7_0x842e('0x2c')](_0x5ea7fd);const _0x5aef4e=new Set(_0x5ea7fd[a7_0x842e('0x4c')](_0xa1dc2f=>_0xa1dc2f['id']));let _0x412686=0x0;while(_0x5aef4e[a7_0x842e('0x5a')]>0x0){const _0x3c734a=_0x3fba03[_0x412686]=[];for(const _0x30e6eb of _0x5aef4e){let _0x2b3ed0=!![];for(const _0x33c703 of _0x152ba4[a7_0x842e('0x31')][_0x30e6eb]){if(_0x5aef4e[a7_0x842e('0x1c')](_0x33c703)){_0x2b3ed0=![];break;}}if(!_0x2b3ed0){continue;}const _0x483830=_0x152ba4[a7_0x842e('0x45')][_0x30e6eb];_0x3c734a[a7_0x842e('0x6c')](_0x483830);}for(const _0xb81e90 of _0x3c734a){_0x5aef4e[a7_0x842e('0x5')](_0xb81e90['id']);}_0x412686++;}return _0x3fba03;}[a7_0x842e('0x2c')](_0x7cf852){const _0x1b2d18=new TaskGraphCreator(this[a7_0x842e('0xf')],this[a7_0x842e('0x5e')]);return _0x1b2d18['createTaskGraph'](_0x7cf852);}}class TaskGraphCreator{constructor(_0x4c9e7d,_0x3db06c){this[a7_0x842e('0xf')]=_0x4c9e7d;this[a7_0x842e('0x5e')]=_0x3db06c;}['createTaskGraph'](_0x48d83f){const _0x464349={'roots':[],'tasks':{},'dependencies':{}};for(const _0xf9ebfc of _0x48d83f){this[a7_0x842e('0x3d')](_0xf9ebfc,_0x464349);const _0x26ec83=getDependencyConfigs(_0xf9ebfc[a7_0x842e('0x67')],this[a7_0x842e('0x5e')],this[a7_0x842e('0xf')]);if(!_0x26ec83){continue;}this['addTaskDependencies'](_0xf9ebfc,_0x26ec83,_0x48d83f,_0x464349);}_0x464349[a7_0x842e('0x61')]=Object[a7_0x842e('0x23')](_0x464349['dependencies'])[a7_0x842e('0x26')](_0x1dc0e2=>_0x464349[a7_0x842e('0x31')][_0x1dc0e2]['length']===0x0);return _0x464349;}[a7_0x842e('0x57')](_0x146a35,_0x431801,_0x32853c,_0x552b0f){for(const _0x52d89f of _0x431801){if(_0x52d89f[a7_0x842e('0x19')]===a7_0x842e('0x66')){for(const _0x1ed670 of _0x32853c){if(_0x1ed670[a7_0x842e('0x67')][a7_0x842e('0x59')]===_0x146a35['target'][a7_0x842e('0x59')]&&_0x1ed670[a7_0x842e('0x67')][a7_0x842e('0x67')]===_0x52d89f['target']){_0x552b0f['dependencies'][_0x146a35['id']][a7_0x842e('0x6c')](_0x1ed670['id']);}}}else if(_0x52d89f[a7_0x842e('0x19')]===a7_0x842e('0x31')){const _0x2e3356=new Set();this[a7_0x842e('0x64')](_0x146a35[a7_0x842e('0x67')][a7_0x842e('0x59')],_0x52d89f[a7_0x842e('0x67')],_0x32853c,_0x552b0f,_0x146a35['id'],_0x2e3356);}}}[a7_0x842e('0x64')](_0x39864b,_0x127b05,_0x3a34e7,_0x1aaae5,_0x16e3fc,_0x52de8e){_0x52de8e[a7_0x842e('0x46')](_0x39864b);const _0x227ee8=this[a7_0x842e('0xf')][a7_0x842e('0x31')][_0x39864b];if(_0x227ee8){const _0xb51352=_0x227ee8[a7_0x842e('0x4c')](_0x56e114=>_0x56e114[a7_0x842e('0x67')]);for(const _0x505868 of _0xb51352){if(_0x52de8e[a7_0x842e('0x1c')](_0x505868)){continue;}const _0x3ad9dd=this[a7_0x842e('0x27')]({'project':_0x505868,'target':_0x127b05},_0x3a34e7);if(_0x3ad9dd){if(_0x1aaae5[a7_0x842e('0x31')][_0x16e3fc][a7_0x842e('0x36')](_0x3ad9dd['id'])===-0x1){_0x1aaae5[a7_0x842e('0x31')][_0x16e3fc][a7_0x842e('0x6c')](_0x3ad9dd['id']);}}else{this[a7_0x842e('0x64')](_0x505868,_0x127b05,_0x3a34e7,_0x1aaae5,_0x16e3fc,_0x52de8e);}}}}[a7_0x842e('0x27')]({project,target},_0x59c7d6){return _0x59c7d6[a7_0x842e('0x4b')](_0x2190fa=>_0x2190fa[a7_0x842e('0x67')]['project']===project&&_0x2190fa['target'][a7_0x842e('0x67')]===target);}[a7_0x842e('0x3d')](_0x1be5d3,_0x4f9e32){_0x4f9e32[a7_0x842e('0x45')][_0x1be5d3['id']]=_0x1be5d3;_0x4f9e32[a7_0x842e('0x31')][_0x1be5d3['id']]=[];}}exports[a7_0x842e('0x32')]=TaskGraphCreator;function getDefaultDependencyConfigs(_0x36c305,_0x305db9){var _0x57f9ce,_0x2755f1;const _0x882adb=(_0x57f9ce=_0x36c305[a7_0x842e('0x18')])!==null&&_0x57f9ce!==void 0x0?_0x57f9ce:{};const _0x353c95=_0x305db9?(_0x2755f1=_0x305db9[a7_0x842e('0x5c')])!==null&&_0x2755f1!==void 0x0?_0x2755f1:['build']:[];for(const _0x44f63b of _0x353c95){_0x882adb[_0x44f63b]=_0x882adb[_0x44f63b]||[];_0x882adb[_0x44f63b]['push']({'target':_0x44f63b,'projects':a7_0x842e('0x31')});}return _0x882adb;}