const a5_0x1751=['Agent\x20','toString','cacheDirectory','startAgent','.lock','readdirSync','next','Waiting...','Waiter','child_process','VERBOSE_LOGGING','\x20--projects=','__awaiter','Error:','target','nx.json','random','../../../utilities/environment','Fetching\x20tasks...','default','getRunGroup','NX_AGENT_NAME','wait','maxParallel','inherit','If\x20you\x20believe\x20this\x20is\x20the\x20case,\x20run\x20\x22npx\x20nx-cloud\x20clean-up-agents\x22.','warn','defineProperty','readFileSync','unlinkSync','value','projectName','maxParallel:\x20','getTime','DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE','throw','configuration','length','../../../utilities/create-no-new-messages-timeout','CIRCLECI','retryDuring:\x20','taskId','We\x20have\x20detected\x20other\x20agents\x20running\x20in\x20this\x20workspace.\x20This\x20can\x20cause\x20unexpected\x20behavior.','../../../utilities/nx-imports','writeFileSync','Other\x20Nx\x20Cloud\x20Agents\x20Detected','completeRunGroupWithError','submitRunMetrics','CIRCLE_STAGE','./distributed-agent.api','Critical\x20Error\x20in\x20Agent:\x20\x22','printRunGroupError','\x20--parallel\x20--max-parallel=','Duplicate\x20Agent\x20ID\x20Detected','../../error/print-run-group-error','API\x20Response','completed','error','DistributedAgentApi','includes','../../../utilities/waiter','Starting\x20an\x20agent\x20for\x20running\x20Nx\x20tasks','completedTasks','npx\x20nx\x20run-many\x20--target=','note','retryDuring','tasks','../../../utilities/metric-logger','This\x20can\x20also\x20be\x20a\x20false\x20positive\x20caused\x20by\x20agents\x20that\x20did\x20not\x20shut\x20down\x20correctly.','criticalErrorMessage','exit','Executing:\x20\x27','executionId','join','assign','params','push','env','apply','then','End\x20all\x20currently\x20running\x20agents,\x20run\x20\x22npx\x20nx-cloud\x20clean-up-agents\x22,\x20and\x20try\x20again.','__esModule','existsSync','floor','strip-json-comments','parse','tasksRunnerOptions','/tasks-hashes-','projects','SIGINT','options',').\x20Tasks\x20hashes\x20haven\x27t\x20been\x20recorded.','./node_modules/.cache/nx'];(function(_0x2829eb,_0x175180){const _0xf68bcc=function(_0x37aef8){while(--_0x37aef8){_0x2829eb['push'](_0x2829eb['shift']());}};_0xf68bcc(++_0x175180);}(a5_0x1751,0x10c));const a5_0xf68b=function(_0x2829eb,_0x175180){_0x2829eb=_0x2829eb-0x0;let _0xf68bcc=a5_0x1751[_0x2829eb];return _0xf68bcc;};'use strict';var __awaiter=this&&this[a5_0xf68b('0x17')]||function(_0x40fdcb,_0x4c5cd5,_0x5859c3,_0x35b582){function _0x49acf0(_0x4e4e50){return _0x4e4e50 instanceof _0x5859c3?_0x4e4e50:new _0x5859c3(function(_0x37a0f3){_0x37a0f3(_0x4e4e50);});}return new(_0x5859c3||(_0x5859c3=Promise))(function(_0x340b9f,_0x1cf0a7){function _0x2672e6(_0x1e2823){try{_0x53c3de(_0x35b582['next'](_0x1e2823));}catch(_0x18bbf6){_0x1cf0a7(_0x18bbf6);}}function _0x3f1ec2(_0x101953){try{_0x53c3de(_0x35b582[a5_0xf68b('0x2e')](_0x101953));}catch(_0xfb604d){_0x1cf0a7(_0xfb604d);}}function _0x53c3de(_0x11eb43){_0x11eb43['done']?_0x340b9f(_0x11eb43[a5_0xf68b('0x29')]):_0x49acf0(_0x11eb43[a5_0xf68b('0x29')])[a5_0xf68b('0x5a')](_0x2672e6,_0x3f1ec2);}_0x53c3de((_0x35b582=_0x35b582[a5_0xf68b('0x59')](_0x40fdcb,_0x4c5cd5||[]))[a5_0xf68b('0x11')]());});};Object[a5_0xf68b('0x26')](exports,a5_0xf68b('0x5c'),{'value':!![]});exports[a5_0xf68b('0xe')]=void 0x0;const child_process_1=require(a5_0xf68b('0x14'));const stripJsonComments=require(a5_0xf68b('0x2'));const distributed_agent_api_1=require(a5_0xf68b('0x3c'));const waiter_1=require(a5_0xf68b('0x47'));const environment_1=require(a5_0xf68b('0x1c'));const print_run_group_error_1=require(a5_0xf68b('0x41'));const create_no_new_messages_timeout_1=require(a5_0xf68b('0x31'));const fs_1=require('fs');const metric_logger_1=require(a5_0xf68b('0x4e'));const {output}=require(a5_0xf68b('0x36'));function executeTasks(_0x5aab92,_0x4f3a15){return __awaiter(this,void 0x0,void 0x0,function*(){let _0x2e284e=0x0;let _0x25cbbb=null;const _0x453e59=(0x0,create_no_new_messages_timeout_1['createNoNewMessagesTimeout'])();const _0x1557a0=new waiter_1[(a5_0xf68b('0x13'))]();let _0x37533f=[];const _0x25a2fe=new Date();let _0x54069e=![];while(!![]){if(environment_1['VERBOSE_LOGGING']){output[a5_0xf68b('0x4b')]({'title':a5_0xf68b('0x1d')});}_0x25cbbb=yield _0x4f3a15[a5_0xf68b('0x4d')](_0x25cbbb?_0x25cbbb[a5_0xf68b('0x53')]:null,_0x2e284e,_0x37533f);if(environment_1[a5_0xf68b('0x15')]){output[a5_0xf68b('0x4b')]({'title':a5_0xf68b('0x42'),'bodyLines':['completed:\x20'+_0x25cbbb['completed'],a5_0xf68b('0x33')+_0x25cbbb['retryDuring'],'executionId:\x20'+_0x25cbbb[a5_0xf68b('0x53')],'number\x20of\x20tasks:\x20'+_0x25cbbb[a5_0xf68b('0x4d')]['length'],'error:\x20'+_0x25cbbb['criticalErrorMessage'],a5_0xf68b('0x2b')+_0x25cbbb[a5_0xf68b('0x22')]]});}if(_0x25cbbb[a5_0xf68b('0x50')]){output[a5_0xf68b('0x44')]({'title':'Distributed\x20Execution\x20Terminated','bodyLines':[a5_0xf68b('0x18'),_0x25cbbb[a5_0xf68b('0x50')]]});process[a5_0xf68b('0x51')](0x0);}if((_0x25cbbb===null||_0x25cbbb===void 0x0?void 0x0:_0x25cbbb[a5_0xf68b('0x4c')])&&(_0x25cbbb===null||_0x25cbbb===void 0x0?void 0x0:_0x25cbbb[a5_0xf68b('0x4c')])!==0x0&&!_0x54069e&&new Date()[a5_0xf68b('0x2c')]()-_0x25a2fe[a5_0xf68b('0x2c')]()>_0x25cbbb[a5_0xf68b('0x4c')]){yield _0x1557a0['wait']();continue;}if(_0x25cbbb[a5_0xf68b('0x43')])return;_0x453e59(_0x25cbbb[a5_0xf68b('0x4d')]['map'](_0xe22d24=>_0xe22d24[a5_0xf68b('0x34')])[a5_0xf68b('0x54')](''));if(!_0x25cbbb[a5_0xf68b('0x53')]){if(environment_1[a5_0xf68b('0x15')]){output['note']({'title':a5_0xf68b('0x12')});}yield _0x1557a0[a5_0xf68b('0x21')]();_0x2e284e=0x0;_0x37533f=[];continue;}_0x1557a0['reset']();_0x54069e=!![];const _0x1c2551=invokeTasksUsingRunMany(_0x5aab92,_0x25cbbb['executionId'],_0x25cbbb[a5_0xf68b('0x4d')],_0x25cbbb[a5_0xf68b('0x22')]);_0x2e284e=_0x1c2551['completedStatusCode'];_0x37533f=_0x1c2551[a5_0xf68b('0x49')];}});}function readCompletedTasks(_0x13c5eb,_0x50a61b){const _0x57a2d2='Command\x20execution\x20failed\x20(distributed\x20task\x20execution:\x20'+_0x50a61b+a5_0xf68b('0x9');let _0x522c93;try{const _0x71163f=_0x13c5eb[a5_0xf68b('0xd')]||'./node_modules/.cache/nx';const _0x32d155=_0x71163f+a5_0xf68b('0x5')+_0x50a61b;_0x522c93=JSON[a5_0xf68b('0x3')]((0x0,fs_1[a5_0xf68b('0x27')])(_0x32d155)[a5_0xf68b('0xc')]());(0x0,fs_1[a5_0xf68b('0x28')])(_0x32d155);}catch(_0x44b236){throw new Error(_0x57a2d2);}if(_0x522c93[a5_0xf68b('0x30')]==0x0){throw new Error(_0x57a2d2);}return _0x522c93;}function invokeTasksUsingRunMany(_0x3bbd17,_0x4b9f87,_0x14c7dd,_0x98a585){let _0x3d0c0a=0x0;const _0x39489d=[];for(const _0x4e2b85 of groupByTarget(_0x14c7dd)){const _0x452315=_0x4e2b85['configuration']?'--configuration='+_0x4e2b85[a5_0xf68b('0x2f')]:'';const _0x1b6975=_0x98a585>0x1?a5_0xf68b('0x3f')+_0x98a585:'';const _0x1024ba=a5_0xf68b('0x4a')+_0x4e2b85[a5_0xf68b('0x19')]+'\x20'+_0x452315+a5_0xf68b('0x16')+_0x4e2b85[a5_0xf68b('0x6')]['join'](',')+'\x20'+_0x4e2b85[a5_0xf68b('0x56')]+_0x1b6975;if(environment_1[a5_0xf68b('0x15')]){output[a5_0xf68b('0x4b')]({'title':a5_0xf68b('0x52')+_0x1024ba+'\x27'});}try{(0x0,child_process_1['execSync'])(_0x1024ba,{'stdio':[a5_0xf68b('0x23'),'inherit',a5_0xf68b('0x23')],'env':Object[a5_0xf68b('0x55')](Object['assign']({},process['env']),{'NX_CACHE_FAILURES':'true','NX_CLOUD_DISTRIBUTED_EXECUTION_ID':_0x4b9f87})});}catch(_0x55c8c1){if(_0x55c8c1['status']===environment_1[a5_0xf68b('0x2d')]){throw _0x55c8c1;}else{_0x3d0c0a=0x1;}}finally{_0x39489d[a5_0xf68b('0x57')](...readCompletedTasks(_0x3bbd17,_0x4b9f87));}}return{'completedStatusCode':_0x3d0c0a,'completedTasks':_0x39489d};}function groupByTarget(_0x18c88e){const _0x4c17ec=[];_0x18c88e['forEach'](_0x514484=>{const _0x1d7c3d=_0x4c17ec['find'](_0x49e18b=>_0x49e18b[a5_0xf68b('0x19')]===_0x514484[a5_0xf68b('0x19')]&&_0x49e18b[a5_0xf68b('0x2f')]===_0x514484[a5_0xf68b('0x2f')]);if(_0x1d7c3d){_0x1d7c3d[a5_0xf68b('0x6')][a5_0xf68b('0x57')](_0x514484[a5_0xf68b('0x2a')]);}else{_0x4c17ec[a5_0xf68b('0x57')]({'target':_0x514484[a5_0xf68b('0x19')],'projects':[_0x514484['projectName']],'params':_0x514484['params'],'configuration':_0x514484[a5_0xf68b('0x2f')]});}});return _0x4c17ec;}function getAgentName(){if(process[a5_0xf68b('0x58')]['NX_AGENT_NAME']!==undefined){return process['env'][a5_0xf68b('0x20')];}else if(process[a5_0xf68b('0x58')][a5_0xf68b('0x32')]!==undefined){return process[a5_0xf68b('0x58')][a5_0xf68b('0x3b')];}else{return a5_0xf68b('0xb')+Math[a5_0xf68b('0x1')](Math[a5_0xf68b('0x1b')]()*0x186a0);}}function createAgentLockfile(_0xad0d39,_0x5d18a8){const _0x18443a=_0xad0d39[a5_0xf68b('0xd')]||a5_0xf68b('0xa');const _0x38565e=_0x18443a+'/lockfiles';const _0x2bfbf4=_0x38565e+'/'+_0x5d18a8+'.lock';if(!(0x0,fs_1[a5_0xf68b('0x0')])(_0x38565e)){(0x0,fs_1['mkdirSync'])(_0x38565e,{'recursive':!![]});}const _0x348f2f=(0x0,fs_1[a5_0xf68b('0x10')])(_0x38565e);if(_0x348f2f[a5_0xf68b('0x30')]){if(_0x348f2f[a5_0xf68b('0x46')](_0x5d18a8+a5_0xf68b('0xf'))){output[a5_0xf68b('0x44')]({'title':a5_0xf68b('0x40'),'bodyLines':['We\x20have\x20detected\x20another\x20agent\x20with\x20this\x20ID\x20running\x20in\x20this\x20workspace.\x20This\x20should\x20not\x20happen.','',a5_0xf68b('0x5b')]});process[a5_0xf68b('0x51')](0x1);}output[a5_0xf68b('0x25')]({'title':a5_0xf68b('0x38'),'bodyLines':[a5_0xf68b('0x35'),'',a5_0xf68b('0x4f'),a5_0xf68b('0x24')]});}(0x0,fs_1[a5_0xf68b('0x37')])(_0x2bfbf4,'');process['on'](a5_0xf68b('0x51'),()=>cleanupAgentLockfile(_0x2bfbf4));process['on'](a5_0xf68b('0x7'),()=>cleanupAgentLockfile(_0x2bfbf4));}function cleanupAgentLockfile(_0x2e6009){if((0x0,fs_1['existsSync'])(_0x2e6009)){(0x0,fs_1[a5_0xf68b('0x28')])(_0x2e6009);}}function startAgent(){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x47afe5=(0x0,environment_1[a5_0xf68b('0x1f')])();if(!_0x47afe5){(0x0,print_run_group_error_1[a5_0xf68b('0x3e')])();return process[a5_0xf68b('0x51')](0x1);}output[a5_0xf68b('0x4b')]({'title':a5_0xf68b('0x48')});const _0x52c934=JSON['parse'](stripJsonComments((0x0,fs_1[a5_0xf68b('0x27')])(a5_0xf68b('0x1a'))['toString']()))[a5_0xf68b('0x4')][a5_0xf68b('0x1e')][a5_0xf68b('0x8')];const _0x24bf87=getAgentName();createAgentLockfile(_0x52c934,_0x24bf87);const _0x35615e=new distributed_agent_api_1[(a5_0xf68b('0x45'))](_0x52c934,_0x47afe5,_0x24bf87);return executeTasks(_0x52c934,_0x35615e)[a5_0xf68b('0x5a')](_0x14182b=>__awaiter(this,void 0x0,void 0x0,function*(){yield(0x0,metric_logger_1[a5_0xf68b('0x3a')])(_0x52c934);return _0x14182b;}))['catch'](_0x1f976d=>__awaiter(this,void 0x0,void 0x0,function*(){yield _0x35615e[a5_0xf68b('0x39')](a5_0xf68b('0x3d')+_0x1f976d['message']+'\x22');throw _0x1f976d;}));});}exports[a5_0xf68b('0xe')]=startAgent;